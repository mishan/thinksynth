# $Id: Makefile.in,v 1.18 2003/12/21 05:57:48 joshk Exp $

BINARY = thinksynth

bindir=@bindir@
libdir=@libdir@
prefix=@prefix@

all: thinksynth thinkseq

include ../build.mk

PICFLAGS = -fPIC
INCLUDES = -I..
LDFLAGS += @LIBS@

LIBOBJS = \
	@NSMODULE_DL_CPP@ \
	thinklang.o \
	thinklex.o \
	thArg.o \
	thAudioBuffer.o \
	thMidiChan.o \
	thMidiNote.o \
	thMod.o \
	thNode.o \
	thOSSAudio.o \
	thPlugin.o \
	thPluginManager.o \
	thSynth.o \
	thWav.o

MAINOBJS = main.o
SEQOBJS = seq.o

thinkseq: libthink.so $(SEQOBJS)
	$(CXX) $(CXXFLAGS) -o $@ $(SEQOBJS) $(LDFLAGS) -lthink -L.

thinksynth: libthink.so $(MAINOBJS)
	$(CXX) $(CXXFLAGS) -o $@ $(MAINOBJS) $(LDFLAGS) -lthink -L.

libthink.so: libthink.so.3
	ln -sf libthink.so.3 libthink.so

libthink.so.3: $(LIBOBJS)
	$(CXX) $(CXXFLAGS) $(LDFLAGS) -shared -Wl,-soname,$@ -o $@ $(LIBOBJS)

libthink.a: $(LIBOBJS)
	ar crsv $@ $(LIBOBJS)

thinklex.cpp: thinklex.ll thinklang.o
	flex -o$@ thinklex.ll

thinklang.hpp:

clean::
	rm -f libthink.so.3

distclean::
	rm -f thinklang.cpp thinklex.cpp thinklang.hpp thinklang.h Makefile

install:
	mkdir -p $(DESTDIR)$(bindir)
	cp -f thinksynth $(DESTDIR)$(bindir)
	cp -f thinkseq $(DESTDIR)$(bindir)
	mkdir -p $(DESTDIR)$(libdir)
	cp -f libthink.so.3 $(DESTDIR)$(libdir)
	ln -sf libthink.so.3 $(DESTDIR)$(libdir)/libthink.so

uninstall:
	rm -f $(DESTDIR)$(bindir)/thinksynth
	rm -f $(DESTDIR)$(bindir)/thinkseq
	rm -f $(DESTDIR)$(libdir)/libthink.so.3 $(DESTDIR)$(libdir)/libthink.so
